# Field Studio - IIIF archive making tool

A local-first, browser-based workbench for organizing, annotating, and connecting field research media using IIIF standards.

## âš ï¸ Disclaimer: Vibe Coded
This project is **vibe coded**, the architecture reflects an experimental POC

## Overview
It bridges the gap between messy field data (raw photos, recordings, notes) and structured archival objects.

- **Local-First:** All data is stored in your browser's IndexedDB. No files are uploaded to a server.
- **Personal IIIF Ecosystem:** Includes an internal IIIF Image API 3.0 server (via Service Workers), a Presentation API 3.0 manifest editor, and a W3C Web Annotation environment.
- **Spatial Thinking:** Use the "Board" view to map relationships between items on an infinite canvas.
- **Standards-Driven:** Built from the ground up to comply with IIIF and W3C Web Annotation specifications.

## ğŸš€ Getting Started

### Prerequisites
- [Node.js](https://nodejs.org/) (v20 or later recommended)
- [npm](https://www.npmjs.com/)

### Local Development
1. **Clone the repository:**
   ```bash
   git clone https://github.com/micahchoo/field-studio.git
   cd field-studio

   ```

2. **Install dependencies:**
   ```bash
   npm install
   ```

3. **Run the development server:**
   ```bash
   npm run dev
   ```

4. **Access the app:**
   Open `http://localhost:3000` in your browser.

**Note:** The application relies on Service Workers (`sw.js`) to serve IIIF image tiles. Ensure you are in a **Secure Context** (localhost or HTTPS). If images fail to load, check the "Service Workers" section in your browser's DevTools Application tab.

### Available Commands

**Development:**
```bash
npm run dev              # Start dev server on http://localhost:3000
npm run build            # Production build
npm run preview          # Preview production build
```

**Testing:**
```bash
npm test                 # Run all tests once
npm run test:watch       # Watch mode (best for development)
npm run test:ui          # Interactive UI for tests
npm run test:coverage    # Generate coverage report
```

**Linting:**
```bash
npm run lint             # Check for linting errors
npm run lint:fix         # Auto-fix linting errors
```

### Extending the Studio


## ğŸ“¦ Deployment
The studio is ready for GitHub Pages. 
1. Push your changes to the `main` branch.
2. Enable GitHub Actions in your repo settings (**Settings > Pages > Build and deployment > Source: GitHub Actions**).
3. The site will be available at `https://<username>.github.io/biiif-web-studio/`.


# Architecture
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            IIIF FIELD ARCHIVE STUDIO v3.0.0                                      â”‚
â”‚                         Browser-Based IIIF Archive Workbench                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                              PRESENTATION LAYER (80+ Components)                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                                VIEW ROUTES                                      â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Archive â”‚  â”‚Structure â”‚  â”‚ Catalog  â”‚  â”‚ Boards   â”‚  â”‚  Viewer  â”‚          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   View   â”‚  â”‚   View   â”‚  â”‚   View   â”‚  â”‚   View   â”‚  â”‚   View   â”‚          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Grid/Listâ”‚  â”‚   Tree   â”‚  â”‚Spreadsheetâ”‚  â”‚  Canvas  â”‚  â”‚ OpenSea- â”‚          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   +      â”‚  â”‚   +      â”‚  â”‚    +     â”‚  â”‚   +      â”‚  â”‚ dragon   â”‚          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Filter   â”‚  â”‚ DnD Reorderâ”‚ â”‚  Filter  â”‚  â”‚  Cards   â”‚  â”‚  DeepZoomâ”‚          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                                 â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                           STAGING UI                                    â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚    Source Pane      â”‚   â†”    â”‚    Archive Pane     â”‚                  â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ File sequences   â”‚   â†•    â”‚  â€¢ Collections      â”‚                  â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Auto-detect      â”‚ Drag   â”‚  â€¢ Manifests        â”‚                  â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Pattern grouping â”‚ Drop   â”‚  â€¢ Hierarchical     â”‚                  â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                                 â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                         SHARED UI COMPONENTS                              â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Sidebar â”‚ â”‚  Inspectorâ”‚ â”‚ Command  â”‚ â”‚   Toast  â”‚ â”‚   Modal  â”‚       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚   Tree   â”‚ â”‚   Panel   â”‚ â”‚ Palette  â”‚ â”‚  System  â”‚ â”‚  Dialogs â”‚       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚Navigationâ”‚ â”‚Metadata   â”‚ â”‚  (Cmd+K) â”‚ â”‚          â”‚ â”‚          â”‚       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  +       â”‚ â”‚Editor     â”‚ â”‚          â”‚ â”‚  Success â”‚ â”‚ Confirm  â”‚       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Filter   â”‚ â”‚  +       â”‚ â”‚  Fuzzy   â”‚ â”‚  Error   â”‚ â”‚  Alert   â”‚       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  +       â”‚ â”‚ Validationâ”‚ â”‚  Search  â”‚ â”‚  Info    â”‚ â”‚  Form    â”‚       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ DnD      â”‚ â”‚  +       â”‚ â”‚  History â”‚ â”‚  Warning â”‚ â”‚          â”‚       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚          â”‚ â”‚ GeoEditor â”‚ â”‚          â”‚ â”‚          â”‚ â”‚          â”‚       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                          â”‚                                               â”‚    â”‚
â”‚  â”‚                                          â–¼                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                     CUSTOM HOOKS (27 hooks)                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ STATE           â”‚ UI BEHAVIOR     â”‚ IIIF/DATA       â”‚ PERFORMANCE           â”‚â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ useIIIFEntity   â”‚ useDialogState  â”‚ useIIIFTraversalâ”‚ useVirtualization     â”‚â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ useVaultState   â”‚ useResizablePanelâ”‚ useVaultSelectorsâ”‚ useTreeVirtualizationâ”‚â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ useSharedSelect â”‚ useResponsive   â”‚ useBreadcrumb   â”‚ useDebouncedCallback  â”‚â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ useHistory      â”‚ useFocusTrap    â”‚                 â”‚ useReducedMotion      â”‚â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ useURLState     â”‚ usePanZoomGesturesâ”‚               â”‚                       â”‚â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚                                                    â”‚
â”‚                                             â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         STATE MANAGEMENT LAYER                                          â”‚    â”‚
â”‚  â”‚                                                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  VAULT (Normalized State) - services/vault.ts (1,309 lines)                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Entities:                                                                      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Collections â”‚ â”‚  Manifests  â”‚ â”‚   Canvases  â”‚ â”‚    Ranges   â”‚               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  (Map)      â”‚ â”‚   (Map)     â”‚ â”‚   (Map)     â”‚ â”‚   (Map)     â”‚               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  id â†’ obj   â”‚ â”‚  id â†’ obj   â”‚ â”‚  id â†’ obj   â”‚ â”‚  id â†’ obj   â”‚               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Indexes:                                                                       â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ references: Record<string, string[]>    // Parent â†’ children IDs            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ reverseRefs: Record<string, string>     // Child â†’ parent ID                â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ collectionMembers: Record<string, string[]> // Multi-parent refs            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ typeIndex: Record<string, EntityType>   // O(1) type lookups                â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ extensions: Record<string, Record>      // Vendor property preservation     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Operations:                                                                    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ normalize(tree) â†’ NormalizedState                                           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ denormalize(state) â†’ IIIFTree                                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ updateEntity(id, updates) â†’ O(1) immutable update                           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ getEntity(id) â†’ O(1) lookup via typeIndex                                   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Features:                                                                      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Immer integration for efficient cloning (USE_IMMER_CLONING flag)            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ structuredClone with JSON fallback                                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Extension preservation for round-tripping vendor properties                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Batch updates for performance                                               â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                          â”‚                                              â”‚    â”‚
â”‚  â”‚                                          â–¼                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  ACTION SYSTEM - services/actions.ts (783 lines)                                â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  17 Action Types:                                                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Entity Updates      â”‚ UPDATE_LABEL, UPDATE_REQUIRED_STATEMENT,              â”‚â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                     â”‚ UPDATE_METADATA, UPDATE_BEHAVIORS, SET_VIEWING_DIR    â”‚â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Structure Changes   â”‚ ADD_CANVAS, REORDER_CANVASES, MOVE_ITEM,              â”‚â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                     â”‚ REMOVE_ITEM                                           â”‚â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Batch Operations    â”‚ BATCH_UPDATE (atomic multi-entity updates)            â”‚â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Range Management    â”‚ ADD_RANGE, REMOVE_RANGE, REORDER_RANGE_ITEMS          â”‚â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Tree Operations     â”‚ RELOAD_TREE (full replace), SET_ROOT                  â”‚â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ History             â”‚ UNDO, REDO                                            â”‚â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Action Flow:                                                                   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  User Action â†’ Dispatcher.validate() â†’ Dispatcher.execute() â†’ Reducer â†’ Vault   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                        â†“                                                           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚              ActionHistory.push() (100-entry limit)                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                        â†“                                                           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚              Subscribers notified â†’ React re-render                               â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚                                                    â”‚
â”‚                                             â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         SERVICE LAYER (32 services)                                      â”‚    â”‚
â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚   CORE IIIF      â”‚   VALIDATION     â”‚     SEARCH       â”‚    EXPORT        â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ iiifBuilder.ts   â”‚ validator.ts     â”‚ searchService.ts â”‚ exportService.ts â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Manifest gen  â”‚  â€¢ Tree-aware    â”‚  â€¢ FlexSearch    â”‚  â€¢ IIIF Bundle   â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Collection    â”‚  â€¢ Issue cats    â”‚  â€¢ Web Worker    â”‚  â€¢ Static Site   â”‚          â”‚    â”‚
â”‚  â”‚  â”‚    construction  â”‚  â€¢ Fix suggestionsâ”‚  â€¢ Autocomplete â”‚  â€¢ GitHub Pages  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Annotation    â”‚                  â”‚  â€¢ Lunr.js exp   â”‚  â€¢ Canopy exp    â”‚          â”‚    â”‚
â”‚  â”‚  â”‚    creation      â”‚ validationHealer â”‚                  â”‚                  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚  â€¢ Auto-fix      â”‚ contentSearch    â”‚ csvImporter.ts   â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ iiifParser.ts    â”‚  â€¢ Safe batch    â”‚  â€¢ OCR/TXT anno  â”‚  â€¢ Import/export â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ v2/v3 parse   â”‚  â€¢ Error boundariesâ”‚   indexing     â”‚  â€¢ Column detect â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Spec bridge   â”‚                  â”‚                  â”‚  â€¢ Batch apply   â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚   IMAGE/TILES    â”‚   AUTH/SYNC      â”‚   METADATA       â”‚   STRUCTURE      â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ tileWorker.ts    â”‚ authService.ts   â”‚ metadataHarvesterâ”‚ autoStructure.ts â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Web Worker    â”‚  â€¢ IIIF Auth 2.0 â”‚  â€¢ EXIF extract  â”‚  â€¢ Pattern match â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Tile pyramid  â”‚  â€¢ Token flow    â”‚  â€¢ GPS extract   â”‚  â€¢ Auto-group    â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Canvas API    â”‚  â€¢ Probe-first   â”‚                  â”‚  â€¢ Range create  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚                  â”‚ metadataTemplate â”‚                  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ imagePipeline/   â”‚ sync/            â”‚  â€¢ CSV templates â”‚ stagingService.tsâ”‚          â”‚    â”‚
â”‚  â”‚  â”‚  canvasPipeline  â”‚  crdtAdapter.ts  â”‚  â€¢ Smart detect  â”‚  â€¢ Layout org    â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  tileCalculator  â”‚  â€¢ Yjs bridge    â”‚                  â”‚  â€¢ Manifest org  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚  syncProvider.ts â”‚                  â”‚                  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ imageSourceResol â”‚  â€¢ Bidirectional â”‚                  â”‚ virtualManifest  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ URL fallback  â”‚    sync          â”‚                  â”‚ Factory.ts       â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Service info  â”‚                  â”‚                  â”‚  â€¢ Raw file â†’    â”‚          â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚                  â”‚                  â”‚    Manifest      â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚   CONTENT STATE  â”‚   PROVENANCE     â”‚   VIEWER COMPAT  â”‚   MISC SERVICES  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ contentState.ts  â”‚ provenanceServiceâ”‚ viewerCompatibiliâ”‚ navPlaceService  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ URL encoding  â”‚  â€¢ Change track  â”‚ ty.ts            â”‚  â€¢ Geospatial    â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Deep linking  â”‚  â€¢ PREMIS exp    â”‚  â€¢ Mirador test  â”‚    metadata      â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Share views   â”‚  â€¢ Audit trail   â”‚  â€¢ UV test       â”‚                  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚                  â”‚  â€¢ Annona test   â”‚ activityStream.tsâ”‚          â”‚    â”‚
â”‚  â”‚  â”‚ selectors.ts     â”‚                  â”‚  â€¢ Clover test   â”‚  â€¢ Change Discov â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ IIIF Selectorsâ”‚                  â”‚                  â”‚    API 1.0       â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  Additional Services:                                                                    â”‚    â”‚
â”‚  â”‚  â€¢ fileIntegrity.ts - SHA-256 deduplication                                              â”‚    â”‚
â”‚  â”‚  â€¢ ingestAnalyzer.ts - Two-pass folder analysis                                          â”‚    â”‚
â”‚  â”‚  â€¢ ingestState.ts - Checkpoint/resume system                                             â”‚    â”‚
â”‚  â”‚  â€¢ remoteLoader.ts - External IIIF fetching                                              â”‚    â”‚
â”‚  â”‚  â€¢ guidanceService.ts - Onboarding/help tracking                                         â”‚    â”‚
â”‚  â”‚  â€¢ avService.ts - Audio/video support                                                    â”‚    â”‚
â”‚  â”‚  â€¢ archivalPackageService.ts - OCFL, BagIt exports                                       â”‚    â”‚
â”‚  â”‚  â€¢ staticSiteExporter.ts - WAX/Canopy generation                                         â”‚    â”‚
â”‚  â”‚  â€¢ specBridge.ts - IIIF v2â†’v3 conversion                                                 â”‚    â”‚
â”‚  â”‚  â€¢ fieldRegistry.ts - Unified field configuration                                        â”‚    â”‚
â”‚  â”‚  â€¢ logger.ts - Centralized logging                                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚                                                    â”‚
â”‚                                             â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      STORAGE LAYER (IndexedDB)                                           â”‚    â”‚
â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚    â”‚
â”‚  â”‚  â”‚  files   â”‚  â”‚derivativesâ”‚ â”‚ project  â”‚  â”‚checkpointsâ”‚ â”‚  tiles   â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚ Original â”‚  â”‚ Tile     â”‚  â”‚ IIIF     â”‚  â”‚ Named    â”‚  â”‚ Image    â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚ uploads  â”‚  â”‚ pyramids â”‚  â”‚ tree     â”‚  â”‚ saves    â”‚  â”‚ tiles    â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚ (SHA-256)â”‚  â”‚ (v2,v3,  â”‚  â”‚ (JSON)   â”‚  â”‚ (JSON)   â”‚  â”‚ (Blob)   â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚          â”‚  â”‚  static) â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚ Key: hashâ”‚  â”‚ Key: id  â”‚  â”‚ Key:     â”‚  â”‚ Key:     â”‚  â”‚ Key:     â”‚                   â”‚    â”‚
â”‚  â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ 'current'â”‚  â”‚ name     â”‚  â”‚ compositeâ”‚                   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚    â”‚
â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  Storage Features:                                                                       â”‚    â”‚
â”‚  â”‚  â€¢ SHA-256 content-addressable storage (automatic deduplication)                         â”‚    â”‚
â”‚  â”‚  â€¢ Derivative versioning with parent-child relationships                                 â”‚    â”‚
â”‚  â”‚  â€¢ Checkpoint rollback system (named save states)                                        â”‚    â”‚
â”‚  â”‚  â€¢ Quota monitoring (90% warning, 95% critical thresholds)                               â”‚    â”‚
â”‚  â”‚  â€¢ Background cleanup of orphaned tiles                                                  â”‚    â”‚
â”‚  â”‚  â€¢ Graceful degradation when storage limits exceeded                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚                                                    â”‚
â”‚                                             â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      SERVICE WORKER (sw.js - 701 lines)                                  â”‚    â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚    â”‚
â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  IIIF IMAGE API 3.0 LEVEL 2 SERVER                                                â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Capabilities:                                                                    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Tile serving: /tiles/{assetId}/{level}/{x}_{y}.jpg                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Info.json generation: /tiles/{assetId}/info.json                               â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Dynamic image processing via OffscreenCanvas                                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Region extraction: pct:x,y,w,h or pixel coords                                 â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Size transformation: w,, ,h, w,h, pct:n                                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Rotation support: 0Â° (simplified for performance)                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Quality: default, color                                                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Format: jpg, png                                                               â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Caching Strategy (500MB LRU):                                                    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  1. Check Cache API first (fast path)                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  2. Fall back to IndexedDB via MessageChannel                                     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  3. Generate from source if needed (Web Worker)                                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  4. Populate Cache API for future requests                                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  5. LRU eviction when 500MB limit exceeded                                        â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```