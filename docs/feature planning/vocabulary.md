Custom Metadata Vocabulary Feature                                                                                                                                                                                                      
                                                                                                                                                                                                                                         
 Overview                                                                                                                                                                                                                                
                                                                                                                                                                                                                                         
 Add support for selecting from built-in vocabulary templates and uploading custom vocabularies, with full integration into CSV import/export and metadata editing.                                                                      
                                                                                                                                                                                                                                         
 ---                                                                                                                                                                                                                                     
 Data Model                                                                                                                                                                                                                              
                                                                                                                                                                                                                                         
 New File: types/vocabulary.ts                                                                                                                                                                                                           
                                                                                                                                                                                                                                         
 export type VocabularyFieldDataType =                                                                                                                                                                                                   
   | 'text' | 'date' | 'uri' | 'controlled' | 'number' | 'language-string';                                                                                                                                                              
                                                                                                                                                                                                                                         
 export interface VocabularyField {                                                                                                                                                                                                      
   key: string;                    // Machine-readable key                                                                                                                                                                               
   label: string;                  // Human-readable label                                                                                                                                                                               
   description?: string;           // Help text                                                                                                                                                                                          
   dataType: VocabularyFieldDataType;                                                                                                                                                                                                    
   iiifProperty?: string;          // Maps to IIIF property (e.g., 'metadata.creator')                                                                                                                                                   
   metadataKey?: string;           // Custom metadata key                                                                                                                                                                                
   controlledValues?: string[];    // For 'controlled' type                                                                                                                                                                              
   repeatable?: boolean;                                                                                                                                                                                                                 
   order?: number;                                                                                                                                                                                                                       
 }                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                         
 export interface VocabularyCategory {                                                                                                                                                                                                   
   key: string;                                                                                                                                                                                                                          
   label: string;                                                                                                                                                                                                                        
   fields: string[];               // Field keys in display order                                                                                                                                                                        
 }                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                         
 export interface VocabularyDefinition {                                                                                                                                                                                                 
   id: string;                                                                                                                                                                                                                           
   name: string;                                                                                                                                                                                                                         
   description: string;                                                                                                                                                                                                                  
   version: string;                                                                                                                                                                                                                      
   isBuiltIn: boolean;                                                                                                                                                                                                                   
   extends?: string;               // Parent vocabulary ID                                                                                                                                                                               
   fields: VocabularyField[];                                                                                                                                                                                                            
   categories: VocabularyCategory[];                                                                                                                                                                                                     
   aliases: { csvColumn: string; fieldKey: string }[];                                                                                                                                                                                   
   referenceUrl?: string;                                                                                                                                                                                                                
   createdAt?: string;                                                                                                                                                                                                                   
   updatedAt?: string;                                                                                                                                                                                                                   
 }                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                         
 ---                                                                                                                                                                                                                                     
 Built-in Templates                                                                                                                                                                                                                      
 ┌──────────────────┬────────────────────┬──────────────────────┬─────────────────────────────────────────────────┐                                                                                                                      
 │        ID        │        Name        │        Domain        │                     Fields                      │                                                                                                                      
 ├──────────────────┼────────────────────┼──────────────────────┼─────────────────────────────────────────────────┤                                                                                                                      
 │ dublin-core      │ Dublin Core        │ General              │ 15 DC elements                                  │                                                                                                                      
 ├──────────────────┼────────────────────┼──────────────────────┼─────────────────────────────────────────────────┤                                                                                                                      
 │ iiif-core        │ IIIF Core Only     │ Minimal              │ label, summary, rights, navDate, attribution    │                                                                                                                      
 ├──────────────────┼────────────────────┼──────────────────────┼─────────────────────────────────────────────────┤                                                                                                                      
 │ archaeology-tdar │ Archaeology (tDAR) │ Field archaeology    │ DC + site, unit, stratum, material type         │                                                                                                                      
 ├──────────────────┼────────────────────┼──────────────────────┼─────────────────────────────────────────────────┤                                                                                                                      
 │ museum-vra       │ Museum (VRA Core)  │ Art/cultural objects │ Work type, technique, materials, measurements   │                                                                                                                      
 ├──────────────────┼────────────────────┼──────────────────────┼─────────────────────────────────────────────────┤                                                                                                                      
 │ archives-isadg   │ Archives (ISAD(G)) │ Archival description │ Reference code, level, scope, access conditions │                                                                                                                      
 └──────────────────┴────────────────────┴──────────────────────┴─────────────────────────────────────────────────┘                                                                                                                      
 ---                                                                                                                                                                                                                                     
 Service Layer                                                                                                                                                                                                                           
                                                                                                                                                                                                                                         
 New File: services/vocabularyService.ts                                                                                                                                                                                                 
                                                                                                                                                                                                                                         
 Key Methods:                                                                                                                                                                                                                            
 - getAllVocabularies() → List of available vocabularies (built-in + custom)                                                                                                                                                             
 - getVocabulary(id) → Full vocabulary definition (handles inheritance via extends)                                                                                                                                                      
 - saveVocabulary(vocab) → Save custom vocabulary to IndexedDB                                                                                                                                                                           
 - deleteVocabulary(id) → Delete custom vocabulary                                                                                                                                                                                       
 - importFromJSON(json) → Parse and save from JSON file                                                                                                                                                                                  
 - importFromCSV(csv) → Parse simple CSV format (key, label, dataType columns)                                                                                                                                                           
 - exportAsJSON(vocab) → Export vocabulary as JSON                                                                                                                                                                                       
 - getColumnAliases(vocab) → Generate CSV alias map for import auto-detection                                                                                                                                                            
                                                                                                                                                                                                                                         
 Storage: IndexedDB vocabularies object store (add to existing db schema)                                                                                                                                                                
                                                                                                                                                                                                                                         
 ---                                                                                                                                                                                                                                     
 UI Components                                                                                                                                                                                                                           
                                                                                                                                                                                                                                         
 VocabularyManagerDialog.tsx                                                                                                                                                                                                             
                                                                                                                                                                                                                                         
 Three-tab dialog:                                                                                                                                                                                                                       
                                                                                                                                                                                                                                         
 1. Select Template - Grid of vocabulary cards with:                                                                                                                                                                                     
   - Name, description, field count                                                                                                                                                                                                      
   - Domain icon                                                                                                                                                                                                                         
   - "Use This" / "Selected" button                                                                                                                                                                                                      
 2. My Vocabularies - List of custom vocabularies with:                                                                                                                                                                                  
   - Edit, duplicate, delete actions                                                                                                                                                                                                     
   - Import date, field count                                                                                                                                                                                                            
 3. Upload Custom - File drop zone with:                                                                                                                                                                                                 
   - JSON/CSV upload                                                                                                                                                                                                                     
   - Preview of parsed fields                                                                                                                                                                                                            
   - Name/description editing before save                                                                                                                                                                                                
                                                                                                                                                                                                                                         
 VocabularyCard.tsx                                                                                                                                                                                                                      
                                                                                                                                                                                                                                         
 Reusable card for vocabulary selection grid.                                                                                                                                                                                            
                                                                                                                                                                                                                                         
 VocabularyEditorDialog.tsx (optional, phase 2)                                                                                                                                                                                          
                                                                                                                                                                                                                                         
 Full editor for creating/modifying custom vocabularies field-by-field.                                                                                                                                                                  
                                                                                                                                                                                                                                         
 ---                                                                                                                                                                                                                                     
 Integration Points                                                                                                                                                                                                                      
                                                                                                                                                                                                                                         
 1. Settings (hooks/useAppSettings.ts)                                                                                                                                                                                                   
                                                                                                                                                                                                                                         
 Add activeVocabularyId: string (default: 'dublin-core')                                                                                                                                                                                 
                                                                                                                                                                                                                                         
 2. Metadata Template Export (services/metadataTemplateService.ts)                                                                                                                                                                       
                                                                                                                                                                                                                                         
 - Load active vocabulary via vocabularyService.getVocabulary()                                                                                                                                                                          
 - Generate CSV columns from vocab.fields instead of hardcoded arrays                                                                                                                                                                    
                                                                                                                                                                                                                                         
 3. CSV Import (services/csvImporter.ts)                                                                                                                                                                                                 
                                                                                                                                                                                                                                         
 - Modify autoDetectMappings() to accept optional vocabularyId                                                                                                                                                                           
 - Merge vocabulary aliases with CSV_COLUMN_ALIASES                                                                                                                                                                                      
 - Pre-populate mappings based on active vocabulary                                                                                                                                                                                      
                                                                                                                                                                                                                                         
 4. CSV Import Dialog (components/CSVImportDialog.tsx)                                                                                                                                                                                   
                                                                                                                                                                                                                                         
 - Show active vocabulary name in header                                                                                                                                                                                                 
 - Use vocabulary-aware auto-detection                                                                                                                                                                                                   
                                                                                                                                                                                                                                         
 5. Inspector (components/Inspector.tsx)                                                                                                                                                                                                 
                                                                                                                                                                                                                                         
 - Use vocabulary for field ordering and hints                                                                                                                                                                                           
 - Show controlled value dropdowns for controlled type fields                                                                                                                                                                            
                                                                                                                                                                                                                                         
 ---                                                                                                                                                                                                                                     
 Files to Create                                                                                                                                                                                                                         
 ┌────────────────────────────────────────┬────────────┐                                                                                                                                                                                 
 │                  File                  │ Est. Lines │                                                                                                                                                                                 
 ├────────────────────────────────────────┼────────────┤                                                                                                                                                                                 
 │ types/vocabulary.ts                    │ ~60        │                                                                                                                                                                                 
 ├────────────────────────────────────────┼────────────┤                                                                                                                                                                                 
 │ services/vocabularyService.ts          │ ~300       │                                                                                                                                                                                 
 ├────────────────────────────────────────┼────────────┤                                                                                                                                                                                 
 │ components/VocabularyManagerDialog.tsx │ ~350       │                                                                                                                                                                                 
 ├────────────────────────────────────────┼────────────┤                                                                                                                                                                                 
 │ components/VocabularyCard.tsx          │ ~80        │                                                                                                                                                                                 
 └────────────────────────────────────────┴────────────┘                                                                                                                                                                                 
 Files to Modify                                                                                                                                                                                                                         
 ┌─────────────────────────────────────┬────────────────────────────────────┐                                                                                                                                                            
 │                File                 │              Changes               │                                                                                                                                                            
 ├─────────────────────────────────────┼────────────────────────────────────┤                                                                                                                                                            
 │ services/index.ts                   │ Export vocabularyService           │                                                                                                                                                            
 ├─────────────────────────────────────┼────────────────────────────────────┤                                                                                                                                                            
 │ services/metadataTemplateService.ts │ Use active vocabulary for columns  │                                                                                                                                                            
 ├─────────────────────────────────────┼────────────────────────────────────┤                                                                                                                                                            
 │ services/csvImporter.ts             │ Vocabulary-aware auto-detection    │                                                                                                                                                            
 ├─────────────────────────────────────┼────────────────────────────────────┤                                                                                                                                                            
 │ components/CSVImportDialog.tsx      │ Show vocabulary, use for mapping   │                                                                                                                                                            
 ├─────────────────────────────────────┼────────────────────────────────────┤                                                                                                                                                            
 │ hooks/useAppSettings.ts             │ Add activeVocabularyId             │                                                                                                                                                            
 ├─────────────────────────────────────┼────────────────────────────────────┤                                                                                                                                                            
 │ types.ts                            │ Add AppSettings.activeVocabularyId │                                                                                                                                                            
 ├─────────────────────────────────────┼────────────────────────────────────┤                                                                                                                                                            
 │ App.tsx                             │ Add vocabulary dialog state        │                                                                                                                                                            
 └─────────────────────────────────────┴────────────────────────────────────┘                                                                                                                                                            
 ---                                                                                                                                                                                                                                     
 UX Flow                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                         
 Template Selection                                                                                                                                                                                                                      
                                                                                                                                                                                                                                         
 1. User opens Settings → Vocabulary (or toolbar button)                                                                                                                                                                                 
 2. VocabularyManagerDialog opens on "Select Template" tab                                                                                                                                                                               
 3. User clicks vocabulary card → sees field preview                                                                                                                                                                                     
 4. User clicks "Use This" → saved to settings, dialog closes                                                                                                                                                                            
                                                                                                                                                                                                                                         
 Custom Upload                                                                                                                                                                                                                           
                                                                                                                                                                                                                                         
 1. User switches to "Upload Custom" tab                                                                                                                                                                                                 
 2. Drag/drop JSON or CSV file                                                                                                                                                                                                           
 3. Preview shows parsed fields                                                                                                                                                                                                          
 4. Edit name/description                                                                                                                                                                                                                
 5. Click "Import" → saved to IndexedDB                                                                                                                                                                                                  
 6. Vocabulary appears in "My Vocabularies" and selection grid                                                                                                                                                                           
                                                                                                                                                                                                                                         
 CSV Import Integration                                                                                                                                                                                                                  
                                                                                                                                                                                                                                         
 1. User imports CSV in Catalog view                                                                                                                                                                                                     
 2. Active vocabulary loaded automatically                                                                                                                                                                                               
 3. Columns auto-mapped using vocabulary aliases                                                                                                                                                                                         
 4. User sees "Using: Dublin Core" indicator                                                                                                                                                                                             
 5. Can switch vocabulary from dropdown if needed                                                                                                                                                                                        
                                                                                                                                                                                                                                         
 ---                                                                                                                                                                                                                                     
 Verification Plan                                                                                                                                                                                                                       
                                                                                                                                                                                                                                         
 1. Unit test: vocabularyService.importFromJSON() parses and validates correctly                                                                                                                                                         
 2. Unit test: vocabularyService.getColumnAliases() returns correct mapping                                                                                                                                                              
 3. Integration test: CSV import with archaeology vocabulary detects "site", "unit", "layer" columns                                                                                                                                     
 4. Manual test:                                                                                                                                                                                                                         
   - Select each built-in template, verify fields change in template export                                                                                                                                                              
   - Upload custom JSON vocabulary, verify it appears in selection                                                                                                                                                                       
   - Import CSV using custom vocabulary, verify auto-mapping works                                                                                                                                                                       
   - Delete custom vocabulary, verify it's removed                                                                                                                                                                                       
╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌
                                                                  